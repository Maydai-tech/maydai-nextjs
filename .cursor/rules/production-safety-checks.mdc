---
description: Production safety checks and merge procedures for thomas branch
globs:
alwaysApply: true
---
# VÃ©rifications de SÃ©curitÃ© Production

## ðŸš¨ CONTEXTE CRITIQUE
La branche `thomas` est mise Ã  jour par un contributeur non-technique.
Les changements de cette branche peuvent casser la production si mal intÃ©grÃ©s.

## ðŸ“‹ CHECKLIST PRÃ‰-MERGE OBLIGATOIRE

### 1. VÃ©rification des Assets
```bash
# Script automatique de vÃ©rification
./scripts/check-thomas-merge.sh

# VÃ©rification manuelle des noms de fichiers
find . -name "* *" -o -name "*Ã©*" -o -name "*Ã¨*" -o -name "*Ã *"
```

**Points critiques** :
- [ ] Aucun fichier avec espaces dans le nom
- [ ] Aucun caractÃ¨re spÃ©cial/accent
- [ ] Images optimisÃ©es (< 500KB)
- [ ] Emplacements corrects dans `/public/`

### 2. VÃ©rification des RÃ©fÃ©rences
```bash
# Chercher les rÃ©fÃ©rences d'images problÃ©matiques
grep -r "\.png\|\.jpg\|\.svg" components/ app/ | grep -E "[ Ã©Ã¨Ã Ã§]"
```

**Ã€ corriger** :
- [ ] Tous les chemins utilisent kebab-case
- [ ] Aucune rÃ©fÃ©rence Ã  des fichiers inexistants
- [ ] Attributs `alt` prÃ©sents et descriptifs

### 3. Tests de Build
```bash
# Tests obligatoires avant merge
npm run build        # Compilation production
npm run lint         # VÃ©rification code
npm test            # Tests unitaires
```

**RÃ©sultats attendus** :
- [ ] Build rÃ©ussi sans erreurs
- [ ] Aucune erreur ESLint critique
- [ ] Tests passent
- [ ] Aucune erreur TypeScript

### 4. Test de Production SimulÃ©
```bash
# Test avec build de production
npm run build && npm run start
```

**VÃ©rifications manuelles** :
- [ ] Page d'accueil charge sans erreur
- [ ] Navigation fonctionne correctement
- [ ] Images s'affichent toutes
- [ ] Console sans erreurs 500/CSP
- [ ] Responsive design prÃ©servÃ©

## ðŸ”„ PROCÃ‰DURE DE MERGE SÃ‰CURISÃ‰E

### Ã‰tape 1 : PrÃ©paration
```bash
# Sauvegarde de la branche dev actuelle
git checkout dev
git branch backup-dev-$(date +%Y%m%d-%H%M%S)

# RÃ©cupÃ©ration des derniers changements
git fetch origin thomas
```

### Ã‰tape 2 : Merge Test en Local
```bash
# Test de merge sans modification
git checkout thomas
git merge dev --no-commit --no-ff

# Si conflits â†’ rÃ©soudre manuellement
# Si OK â†’ annuler pour faire le vrai merge
git merge --abort
```

### Ã‰tape 3 : Merge RÃ©el
```bash
# Merger dev dans thomas d'abord
git merge dev
git push origin thomas

# Puis merger thomas dans dev
git checkout dev
git merge thomas
```

### Ã‰tape 4 : VÃ©rification Post-Merge
```bash
# Re-tests complets aprÃ¨s merge
npm run build
npm run test
npm run dev  # Test manuel
```

## ðŸš¨ GESTION DES PROBLÃˆMES

### Erreurs de Build
1. **Identifier** : `git diff dev~1..dev --name-only`
2. **Analyser** : VÃ©rifier les fichiers modifiÃ©s
3. **Corriger** : Renommer assets problÃ©matiques
4. **Re-tester** : `npm run build`

### Erreurs CSP/Headers
1. **VÃ©rifier** : `middleware.ts` non modifiÃ©
2. **ContrÃ´ler** : `next.config.ts` intact
3. **Supprimer** : Headers Link automatiques
4. **Tester** : En local puis en prod

### RÃ©gressions Fonctionnelles
1. **Rollback immÃ©diat** : `git revert HEAD`
2. **Identifier** : Commit problÃ©matique
3. **Fix ciblÃ©** : Correction spÃ©cifique
4. **Nouveau merge** : AprÃ¨s validation

## ðŸ“Š MÃ‰TRIQUES DE QUALITÃ‰

### Avant Merge
- Build time < 2 minutes
- Aucune erreur TypeScript
- Tests coverage maintenu
- Images < 500KB chacune

### AprÃ¨s Merge
- Application dÃ©marre < 30 secondes
- Pages se chargent < 3 secondes
- Aucune erreur 500 en console
- Mobile responsive prÃ©servÃ©

## ðŸŽ¯ SCRIPTS D'AUTOMATISATION

### VÃ©rification ComplÃ¨te
```bash
#!/bin/bash
# scripts/check-thomas-merge.sh
echo "ðŸ” VÃ©rification branche thomas..."

# 1. VÃ©rification assets
find . -name "* *" -o -name "*Ã©*" | wc -l

# 2. Test build
npm run build

# 3. Test lint
npm run lint

# 4. Rapport final
echo "âœ… VÃ©rification terminÃ©e"
```

### Correction Automatique
```bash
#!/bin/bash
# scripts/fix-thomas-assets.sh
echo "ðŸ”§ Correction automatique des assets..."

# Renommage automatique
./scripts/rename-problematic-files.sh

# Mise Ã  jour des rÃ©fÃ©rences
echo "âš ï¸ VÃ©rifier manuellement les rÃ©fÃ©rences dans le code"
```

## ðŸ“ TEMPLATE DE COMMIT

```
feat/fix: Merge thomas - [Description]

Changements depuis thomas:
- Assets: [fichiers ajoutÃ©s/modifiÃ©s]
- Contenu: [pages/textes modifiÃ©s]
- Technique: [impacts potentiels]

VÃ©rifications:
âœ… Build rÃ©ussi
âœ… Assets nommÃ©s correctement  
âœ… RÃ©fÃ©rences mises Ã  jour
âœ… Tests passants
âœ… Production simulÃ©e OK

Co-authored-by: Thomas <thomas@mayday-consulting.ai>
ðŸ¤– Generated with [Claude Code](https://claude.ai/code)
```

## ðŸŽ¯ OBJECTIF
Garantir que chaque merge depuis `thomas` maintient la stabilitÃ© de la production tout en permettant l'Ã©volution du contenu.