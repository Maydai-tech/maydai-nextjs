---
description:
globs:
alwaysApply: false
---
# Authentication Patterns

## Standardized Auth Pattern
Based on workspace memory, all usecase pages follow consistent authentication patterns:

## Standard Implementation
```typescript
export default function UseCasePage() {
  const { user, loading } = useAuth()
  const router = useRouter()
  const [mounted, setMounted] = useState(false)

  // Prevent hydration mismatch
  useEffect(() => {
    setMounted(true)
  }, [])

  // Auth redirect
  useEffect(() => {
    if (mounted && !loading && !user) {
      router.push('/login')
    }
  }, [user, loading, router, mounted])

  // Loading states
  if (!mounted || loading) {
    return <UseCaseLoader />
  }

  if (!user) {
    return null
  }

  // Page content...
}
```

## Three Auth Patterns

### 1. Auth Pages (login/signup)
- Simple `isCheckingAuth` pattern
- Direct and straightforward

### 2. Protected Pages (dashboard, usecases, profil)  
- `mounted + loading` pattern for SSR robustness
- Used in: [page.tsx](mdc:app/usecases/[id]/page.tsx), [evaluation/page.tsx](mdc:app/usecases/[id]/evaluation/page.tsx), [rapport/page.tsx](mdc:app/usecases/[id]/rapport/page.tsx)

### 3. Admin Pages
- `ProtectedRoute` wrapper component
- Centralized and reusable

## Key Requirements
- **SSR Compatibility**: Always use `mounted` state
- **Loading States**: Show consistent loaders
- **Automatic Redirects**: No manual auth checks in components
- **Responsive Design**: All auth flows work on mobile/tablet

## Critical Rules
- **Always use `mounted` state** for SSR compatibility
- **Consistent loading states** across all pages
- **Auto-redirects only** - no manual auth checks in components

- **Pattern 2** (`mounted + loading`) is the most secure as it prevents SSR hydration vulnerabilities
- Always use defensive programming: assume content should be hidden by default
- Client-side authentication is for UX only - real security must be enforced server-side
- Use the `useAuth` hook from [lib/auth.tsx](mdc:lib/auth.tsx) for all authentication logic
